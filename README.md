# URL Shortener Service

Консольное приложение для сокращения ссылок с поддержкой лимитов переходов, времени жизни (TTL) и многопользовательского режима.

## Возможности

- **Сокращение URL**: Преобразование длинных ссылок в короткие коды формата `clck.ru/XXXXXX`
- **Уникальность**: Каждый пользователь получает уникальную короткую ссылку, даже для одинаковых URL
- **Лимит переходов**: Автоматическая блокировка ссылки после исчерпания заданного количества переходов
- **Время жизни (TTL)**: Автоматическое удаление ссылок по истечении срока действия (по умолчанию 24 часа)
- **Идентификация пользователей**: UUID-based идентификация без авторизации
- **Контроль доступа**: Редактировать и удалять ссылки может только их создатель
- **Автоматическая очистка**: Фоновый процесс удаления устаревших ссылок
- **Открытие в браузере**: Автоматическое перенаправление на исходный URL

## Требования

- **Java**: JDK 17 или выше
- **Maven**: 3.6+ (для сборки и тестирования)

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone https://github.com/YourUsername/UrlShortener.git
cd UrlShortener
```

### 2. Сборка проекта

```bash
mvn clean package
```

### 3. Запуск приложения

```bash
mvn exec:java -Dexec.mainClass="com.urlshortener.Main"
```

Или запустите скомпилированный JAR:

```bash
java -cp target/UrlShortener-1.0-SNAPSHOT.jar com.urlshortener.Main
```

## Конфигурация

Настройки находятся в файле `src/main/resources/application.properties`:

```properties
# Время жизни ссылки в минутах (по умолчанию 1440 = 24 часа)
app.default.ttl.minutes=1440

# Лимит переходов по умолчанию
app.default.limit=5

# Интервал автоматической очистки в секундах
app.cleanup.interval.seconds=60
```

## Использование

### Доступные команды

После запуска приложения введите команду в консоль:

#### `shorten <url> [limit]`
Создать короткую ссылку. Лимит переходов опционален.

**Примеры:**
```
> shorten https://www.example.com
Короткая ссылка: clck.ru/AbCd12

> shorten https://www.google.com 10
Короткая ссылка: clck.ru/XyZ789
```

#### `open <short_url>`
Перейти по короткой ссылке (открывает браузер и увеличивает счетчик).

**Пример:**
```
> open clck.ru/AbCd12
Перенаправление на: https://www.example.com
```

#### `list`
Показать все ссылки текущего пользователя с их статистикой.

**Пример:**
```
> list
Code       | Visits     | Expires
AbCd12     | 2/5        | 2026-01-06T10:15:30
XyZ789     | 0/10       | 2026-01-06T10:20:45
```

#### `edit-limit <short_url> <new_limit>`
Изменить лимит переходов (только для владельца ссылки).

**Пример:**
```
> edit-limit clck.ru/AbCd12 50
Лимит обновлен. Новый лимит: 50
```

#### `delete <short_url>`
Удалить ссылку (только для владельца).

**Пример:**
```
> delete clck.ru/AbCd12
Ссылка удалена.
```

#### `new-user`
Сгенерировать новый UUID (эмуляция смены пользователя для тестирования).

**Пример:**
```
> new-user
Сгенерирован новый пользователь: 123e4567-e89b-12d3-a456-426614174000
```

#### `help`
Показать справку по доступным командам.

#### `exit`
Завершить работу приложения.

## Архитектура проекта

Проект следует принципам **Clean Architecture** и разделен на слои:

```
src/main/java/com/urlshortener/
├── config/            # Конфигурация (загрузка application.properties)
│   └── AppConfig.java
├── model/             # Модели данных
│   └── ShortLink.java
├── repository/        # Слой доступа к данным (in-memory storage)
│   └── LinkRepository.java
├── service/           # Бизнес-логика
│   └── LinkService.java
└── Main.java          # CLI интерфейс и точка входа
```

### Ключевые компоненты

- **AppConfig**: Загружает параметры из `application.properties`
- **ShortLink**: Модель сокращенной ссылки с полями: код, URL, владелец, лимиты, TTL
- **LinkRepository**: Thread-safe хранилище на основе `ConcurrentHashMap`
- **LinkService**: Реализует всю бизнес-логику (создание, валидация, переходы, очистка)
- **Main**: CLI интерфейс с обработкой команд и фоновым процессом очистки

### Основные принципы

- **SOLID**: Разделение ответственности, инверсия зависимостей через конструкторы
- **Thread-Safety**: Использование `ConcurrentHashMap` и `ScheduledExecutorService`
- **Dependency Injection**: Все зависимости передаются через конструкторы
- **Clean Code**: Понятные имена, небольшие методы, отсутствие дублирования

## Тестирование

Проект содержит unit-тесты для всех ключевых сценариев.

### Запуск тестов

```bash
mvn test
```

### Покрытие тестами

Тесты проверяют:

1.  Уникальность ссылок для разных пользователей
2.  Блокировку по лимиту переходов
3.  Контроль доступа (UUID-based ownership)
4.  Редактирование параметров владельцем
5.  Множественные ссылки у одного пользователя
6.  Обработку несуществующих ссылок
7.  Удаление ссылок владельцем
8.  Использование дефолтного vs кастомного лимита
9.  Изоляцию данных между пользователями

**Всего тестов**: 8+
**Покрытие**: >60% (ключевая бизнес-логика)

## Сценарии использования

### Сценарий 1: Базовое сокращение ссылки

```
> shorten https://www.baeldung.com/java-9-http-client
Короткая ссылка: clck.ru/3DZHeG

> open clck.ru/3DZHeG
Перенаправление на: https://www.baeldung.com/java-9-http-client
```

### Сценарий 2: Работа с лимитами

```
> shorten https://example.com 2
Короткая ссылка: clck.ru/LmT123

> open clck.ru/LmT123
Перенаправление на: https://example.com

> open clck.ru/LmT123
Перенаправление на: https://example.com

> open clck.ru/LmT123
Уведомление: Лимит переходов по ссылке исчерпан. Ссылка недоступна.
```

### Сценарий 3: Многопользовательский режим

```
> shorten https://github.com
Короткая ссылка: clck.ru/User1A
Ваш ID: 11111111-1111-1111-1111-111111111111

> new-user
Сгенерирован новый пользователь: 22222222-2222-2222-2222-222222222222

> shorten https://github.com
Короткая ссылка: clck.ru/User2B

> delete clck.ru/User1A
Ошибка доступа: Вы не являетесь создателем этой ссылки.
```

## CI/CD с GitHub Actions

Проект настроен для автоматической сборки и тестирования через GitHub Actions.

**Workflow включает**:
- Сборку проекта (`mvn clean package`)
- Запуск всех тестов (`mvn test`)
- Проверку качества кода (опционально: Checkstyle/SpotBugs)

См. `.github/workflows/maven.yml`

## Обработка ошибок

Приложение корректно обрабатывает следующие ситуации:

-  Ссылка не найдена
-  Лимит переходов исчерпан
-  Срок действия ссылки истек
-  Попытка редактирования чужой ссылки
-  Невалидные параметры команд

## Ограничения текущей версии

- Хранение данных только в памяти (при перезапуске все ссылки теряются)
- Нет персистентности UUID пользователей между сессиями
- Нет REST API (только CLI)
- Браузер открывается только на системах с поддержкой `Desktop.getDesktop()`

